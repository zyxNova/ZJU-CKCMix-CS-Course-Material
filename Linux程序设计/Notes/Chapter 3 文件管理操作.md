# Chapter 3 文件管理操作

[TOC]



## 文件搜索`find`

### 语法

| 选项            | 用处                                                         |
| --------------- | ------------------------------------------------------------ |
| `-exec CMD`     | 如果命令(CMD)返回0(即该命令返回值为真)，则该文件符合要求; 命令必须以 `\;` 结束 |
| `-ok CMD`       | 和-exec相同，执行命令需要确认                                |
| `-name pattern` | 搜索文件名匹配pattern的文件                                  |
| `\( expr \)`    | 当表达式为真结果为真;表达式可以用OR和AND组合                 |
| `! expr`        | 取反，当表达式为假时结果为真                                 |
| `-print`        | 显示符合要求的文件路径和文件名                               |
| `-newer file`   | 搜索修改时间在file之后的文件(即比file新的文件)               |
| `-inum N`       | 搜索inode 为N的文件                                          |
| `-perm octal`   | 搜索访问权限等于octal(八进制数字，如777)的文件               |
| `-size ±N[c]`   | 搜索文件大小为*N*块。字符c用来确定块的大小，默认为512个字    |

### 例子

- 在主目录搜索Pakistan.gif，并显示文件的路径。如果在多个目录中找到目标文件，那么每一个包 含文件的目录都会显示出来。

```shell
find ~ -name Pakistan.gif –print
```

- 如果想知道一个文件的所有硬链接，你可以用下面这个命令，找到/usr和.(当前目录)下所有文件，inode=258072，并把他们打印出来。

```shell
find /usr . –inum 258072 –print
```

- 搜索当前目录下文件名为core或者扩展名为.ps或者.p的文件，显示他们的绝对路径，并将它们 删除。括号用来标明需要匹配的表达式，*在\(和-o前后必须要有空格*。这个命令没有提示直接删除匹配的文件;如果想要提示，用参数-ok替换-exec。

```shell
find . \( -name core –o –name ‘*.ps’ –o –name ‘*.p’ \) –print –exec rm {} \;
```



## 搜索命令

### `whereis`

#### 语法

**用途**：搜索文件列表中的文件，给出可执行文件，源代码，帮助文件的位置

**输出：**文件列表中命令的可执行文件，源代码，帮助文件的绝对路径

| 选项(Linux) | 功能             |
| ----------- | ---------------- |
| `-b`        | 只搜索可执行文件 |
| `-m`        | 只搜索帮助文件   |
| `-s`        | 只搜索源代码     |

#### 例子

```shell
$ whereis ftp
ftp: /usr/bin/ftp.expect /usr/bin/ftp /usr/bin/ftp.sh /usr/man/man1/ftp.1.bz2
```



### `which`

#### 用途

如果一个系统中有多个版本命令，which命令告诉当输入某个命令执行时，shell到底调用了哪个版本的命令。

which命令的作用是在**PATH变量制定的路径**中，查找系统命令的位置。

#### 例子

```shell
$ which gzip 
/bin/gzip
```





## 搜索文件内容

### `grep, egrep, fgrep`

```shell
grep [选项] [模式] [文件列表] 
egrep[选项] [字符串] [文件列表]
fgrep[选项] [表达式] [文件列表]
```

**用途：**按照给定的模式、字符串或表达式搜索文件列表中的文件。如果没有文件列表，则从标准输入读入数据

**输出：**标准输出中包含给定模式、字符串或表达式的行

| 选项 | 用处                                                         |
| ---- | ------------------------------------------------------------ |
| `-c` | 仅输出匹配的行的个数                                         |
| `-i` | 在匹配的过程中忽略字母的大小写                               |
| `-l` | 仅输出有匹配行的文件名                                       |
| `-n` | 匹配时同时输出行号                                           |
| `-s` | 对shell脚本有用，避免出现错误信息(如果成功返回0，失败返回非零值) |
| `-v` | 打印出不匹配的行                                             |
| `-w` | 全字匹配                                                     |

**区别：**

- fgrep命令是最快的，不过有较多的限制。
- egrep 是最慢的，不过是最灵活的，完全支持正则表达式。
- grep 具有合理的速度和相当地对正则表达式的支持。



### 例子

- 显示文件students中包含至少连续8个小写字母单词的行。

```shell
grep '[a-z]\{8\}' students
John Johnsen jjohnsen@psu.net 301.999.8888 Jamie Davidson j.davidson@uet.edu 515.001.2932
```

- 查找/dev目录下有多少个字符设备文件

```shell
ls -l|grep "^c"|wc -l
```

