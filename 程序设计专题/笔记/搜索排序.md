# æœç´¢ä¸æ’åº *Searching&Sorting*

## TDD-*Test Driven Design*

- ***æµ‹è¯•é©±åŠ¨è®¾è®¡æ¨¡å¼***â€”â€”å…ˆå†™å¥½æµ‹è¯•ä»£ç ï¼Œå†å†™åŠŸèƒ½å‡½æ•°

- **test case** è¾¹ç•Œæ¡ä»¶

- **Unit Test** å•å…ƒæµ‹è¯•ï¼ˆåº•å±‚æµ‹è¯•ï¼‰*åŒç™¾æ–¹é’ˆ*

```c
int search(int a[],int len,int x);

int main() {
  int a[] = {12,13,4,92,35,6,23,10};
  printf("1:%d\n",search(a,sizeof(a)/sizeof(a[0]),4)==2?1:0);
  printf("2:%d\n",search(a,sizeof(a)/sizeof(a[0]),5)==-1?1:0);
  printf("3:%d\n",search(a,sizeof(a)/sizeof(a[0]),12)==0?1:0);
  printf("4:%d\n",search(a,sizeof(a)/sizeof(a[0]),10)==sizeof(a)/sizeof(a[0])?1:0);
}

int search(int a[],int len,int x){
  return 2;//æ£€éªŒæµ‹è¯•ä»£ç æ­£ç¡®æ€§
}
```



## Search

### Linear Search

#### ç®—æ³•æ—¶é—´å¤æ‚åº¦

- worst case
- Oæ ‡è®°æ³•ï¼šçœç•¥ç³»æ•°å’Œå°é¡¹
- å¸¸è§å¤æ‚åº¦
  - O(N) `for (i = 0;i<len;i++)`éå†æ•°ç»„/é“¾è¡¨
  - O(N^2) `for (i=0;i<m;i++) {for (j=0;j<n;j++) ...}`åµŒå¥—å¾ªç¯
  - O(logN) å¦‚äºŒåˆ†æœç´¢

çº¿æ€§æœç´¢å¤æ‚åº¦O(N)



### Binary Search *äºŒåˆ†æœç´¢*

#### ä½¿ç”¨å‰æï¼š**å·²æ’åºçš„æ•°æ®**

#### æ•°å­¦æ¨¡å‹

xä¸ºæ•°æ®é›†ï¼Œsä¸ºæœç´¢ç›®æ ‡

f(x,s)	    = can not find, begin > end

â€‹				= x[mid], s == x[mid]

â€‹				= f(lower half of x,s), s < x[mid]

â€‹				= f(higher half of x,s), s > x[mid]

#### é€’å½’å®ç°

```c
int bsearch(int a[], int begin, int end, int x) {
  if (begin > end) return -1;
  int mid = (begin+end)/2;
  if (a[mid] == x) return mid;
  else if (a[mid] < x) return bsearch(a,mid+1,end,x);
  else return bsearch(a,begin,mid-1,x);
}
```

- **ä¼ªé€’å½’**ï¼ˆé€’è¿›æ—¶è®¡ç®—ï¼Œå›å½’æ—¶ä¸è®¡ç®—ï¼‰
- **çº¿æ€§é€’å½’**

#### è¿­ä»£å®ç°

```c
int bsearch(int a[], int begin, int end, int x) {
  int ret = -1;
  while (begin <= end) {
  	int mid = (begin+end)/2;
  	if (a[mid] == x) {
      ret = mid;
      break;//ä¸è¦æ¼äº†è¿™å¥
    }
  	else if (a[mid] < x) begin = mid+1;
  	else end = mid-1;
  }
  return ret;
}
```

- æ—¶é—´å¤æ‚åº¦ O(logN)  *log è¡¨ç¤º log2*
- è¿­ä»£æ¯”é€’å½’æ›´å®¹æ˜“çœ‹å‡ºæ—¶é—´å¤æ‚åº¦

#### *Small Trick:*æµ‹è¯•å¯è§†åŒ– 



## Sort

### Select *é€‰æ‹©æ’åº*

#### æ’åºæ€è·¯ï¼ˆé€’å½’ï¼‰

- æ‰¾åˆ°æœ€å¤§å€¼ï¼Œæ”¾åœ¨æœ€å
- `sort(a,len-1)`

#### ä»£ç å®ç°

##### é€’å½’

###### Version1

```c
void select(int a[], int len) {
	if (len > 0) {
    int loc = findmax(a,len);
    //swap(a[loc],a[len-1]);
    int t = a[loc];
    a[loc] = a[len-1];
    a[len-1] = t;
    select(a,len-1);
  }
}

int findmax(int a[],int len) {
  int max = 0;
  for (int i=1;i<len;i++) {
    if (a[i] > a[max]) max = i;
  }
  return max;
}
```

###### Version2

```c
void select(int a[], int len) {
  if (len > 0) {
    int max = 0;
    for (int i=1;i<len;i++) {
      if (a[i]>a[max]) max = i;
    }
    int t = a[max];
    a[max] = a[len-1];
    a[len-1] = t;
    select(a,len-1);
  }
} 
```

- ä¼ªé€’å½’
- çº¿æ€§é€’å½’

##### è¿­ä»£

###### Version1 *whileå¾ªç¯*

```c
void select(int a[], int len) {
  while (len>0) {
    int max = 0;
    for (int i=1;i<len;i++) {
      if (a[i]>a[max]) max = i;
    }
    int t = a[max];
    a[max] = a[len-1];
    a[len-1] = t;
    len--;
  }
} 
```

###### Version2 *forå¾ªç¯*

```c
void select(int a[], int len) {
  for (;len>0;len--)
    int max = 0;
    for (int i=1;i<len;i++) {
      if (a[i]>a[max]) max = i;
    }
    int t = a[max];
    a[max] = a[len-1];
    a[len-1] = t;
  }
} 
```

###### Version3 *è¾ƒä¸ºå¸¸è§çš„åŒé‡å¾ªç¯å†™æ³•*

```c
void select(int a[],int len) {
  for (int i=0;i<len-1;i++) {
    int min = i;
    for (int j=i+1;j<len;j++) {
      if (a[j]<a[min]) min = j;
    }
    int t = a[i];
    a[i] = a[min];
    a[min] = t;
  }
}
```

- æ—¶é—´å¤æ‚åº¦ O(N^2)

#### æ”¹è¿›æ€è·¯

- æ¯æ¬¡åŒæ—¶æ‰¾æœ€å¤§å€¼å’Œæœ€å°å€¼ï¼›
- æ‰¾æœ€å¤§å€¼å’Œæ¬¡å¤§å€¼ï¼›
- æ‰¾æœ€å¤§ã€æ¬¡å¤§ã€æœ€å°ã€æ¬¡å°
  - ä½†æ˜¯ä»ç„¶æ˜¯O(N)

#### *Small Trick*:éšæœºæ•°å‘ç”Ÿå™¨

```c
#include <stdlib.h>
int main() {
  int a[10];
  srand(0);//seed == 0
  for (int i=0;i<10;i++) {
    a[i] = rand() % 100;
  }
  
}
```





### Bubble Sort *å†’æ³¡æ’åº*

#### æ’åºæ€è·¯

- æ¯ä¸€æ¬¡éå†ä¸­ï¼Œä¸¤ä¸¤æ¯”è¾ƒç›¸é‚»çš„ä¸¤é¡¹ï¼Œå°†è¾ƒå¤§çš„åç§»
- å†’æ³¡ï¼šæœ€å¤§é¡¹åƒæ°”æ³¡ä¸€æ ·æµ®åˆ°æ•°ç»„å°¾éƒ¨

#### ä»£ç å®ç°

##### åŸºæœ¬ç‰ˆæœ¬

```c
void bubble(int a[],int len) {
  for (int i=0;i<len;i++) {
    for (int j=i;j<len-1;j++) {
      if (a[j] > a[j+1]) {
        int t = a[j];
        a[j] = a[j+1];
        a[j+1] = t;
      }
    }
  }
}
```

##### æ”¹è¿›ç‰ˆæœ¬

- Bubble sortä¸€èˆ¬åœ¨ç¬¬næ¬¡éå†ä¹‹å‰å·²ç»ç»“æŸ

```c
void bubble(int a[],int len) {
  for (int i=0;i<len;i++) {
    int flag;
    for (int j=0;j<len-i-1;j++) {//æ³¨æ„å†…å±‚å¾ªç¯å§‹ç»ˆ
      flag = 0;
      if (a[j] > a[j+1]) {
        int t = a[j];
        a[j] = a[j+1];
        a[j+1] = t;
        flag++;
      }
    }
    if (!flag) break;
  }
}
```



#### æ—¶é—´å¤æ‚åº¦

- **æ—¶é—´å¤æ‚åº¦** O(N^2)ï¼Œå’Œé€‰æ‹©æ’åºç›¸ä¼¼

- è€ƒè™‘å¤æ‚åº¦æ—¶ï¼Œä»…è€ƒè™‘å¾ªç¯æ¬¡æ•°ï¼Œä¸è€ƒè™‘å¾ªç¯å†…åšäº†å¤šå°‘äº‹æƒ…



### ğŸŒŸHash Sort *å“ˆå¸Œæ’åº/æ¡¶æ’åº*



### Insert Sort *æ’å…¥æ’åº*

#### æ’åºæ€è·¯

æœ‰nä¸ªå…ƒç´ çš„æ•°åˆ—ï¼Œå…ˆä½¿å‰n-1ä¸ªå…ƒç´ æœ‰åºï¼Œå†å°†ç¬¬nä¸ªå…ƒç´ æ’å…¥å…¶ä¸­



#### ä»£ç å®ç°

##### é€’å½’ç®—æ³•

```c
//1 3 5 7 9 4
void InsertSort(int a[],int n) {
  if (n>0) InsertSort(a,n-1);//å°†å‰n-1ä¸ªå…ƒç´ æ’å¥½
  int x = a[n-1],j = n-2;
  while (j>=0 && a[j]>x) {
    a[j+1] = a[j];
    j--;
  }
  a[j+1] = x;//æ’å…¥ç¬¬nä¸ªå…ƒç´ åˆ°æœ‰åºä½ç½®
}
```

- çº¿æ€§é€’å½’
- çœŸé€’å½’
  - æ³¨æ„åˆ°é€’è¿›è¿‡ç¨‹åªæ˜¯å°†nä¸ªå…ƒç´ åˆ†æˆå•ä¸ªå…ƒç´ 
  - å®é™…ä¸Šå¯ä»¥ä¸ç®¡é€’è¿›ï¼Œç›´æ¥å†™å›å½’â€”â€”è¿­ä»£



##### è¿­ä»£ç®—æ³•

```c
void InsertSort(int a[],int n) {
  for (int i=1;i<n;i++) {
    int x = a[i], j = i-1;//xæ˜¯è¦æ’åºå…ƒç´ çš„å€¼ï¼Œjæ ‡è®°æœ‰åºæ•°åˆ—çš„æœ«ä½ç½®
    while (j>=0 && a[j]>x) {
      a[j+1] = a[j];
      j--;
    }
    a[j+1] = x;
  }
}
```



#### æ—¶é—´å¤æ‚åº¦

- è¿­ä»£ç®—æ³•å¯è§ï¼ŒO(N^2)

#### é€‚ç”¨åœºæ™¯

- å°†ä¸€ä¸ªæ–°çš„æ•°æ®æ”¾åˆ°åŸæœ‰æœ‰åºçš„æ•°åˆ—ä¸­â€”â€”O(N)

- åŠ¨æ€ç¼“æ…¢åœ°åŠ å…¥æ–°çš„æ•°æ®





### **Merge** Sort *å½’å¹¶æ’åº*

*merge,æ„ä¸ºåˆå¹¶*

#### æ’åºæ€è·¯

	1. å…ˆå°†é•¿åº¦ä¸ºNçš„æ— åºåºåˆ—åˆ†å‰²å¹³å‡åˆ†å‰²ä¸ºä¸¤æ®µ
	2. ç„¶ååˆ†åˆ«å¯¹å‰åŠæ®µè¿›è¡Œå½’å¹¶æ’åºã€ååŠæ®µè¿›è¡Œå½’å¹¶æ’åº
	3. æœ€åå†å°†æ’åºå¥½çš„å‰åŠæ®µå’ŒååŠæ®µå½’å¹¶

è¿‡ç¨‹ï¼ˆ2ï¼‰ä¸­è¿›è¡Œé€’å½’æ±‚è§£

<img src="/Users/particle/Desktop/1.jpeg" alt="1" style="zoom:80%;" />

- ç‰ºç‰²ç©ºé—´æ¢å–æ—¶é—´
- åˆ†è€Œæ²»ä¹‹-*Divide&Conquer*ï¼Œæ ¸å¿ƒæ€æƒ³å°±æ˜¯**åˆ†è§£ã€æ±‚è§£ã€åˆå¹¶**

#### TopDown *è‡ªé¡¶å‘ä¸‹çš„é€’å½’å®ç°*

```c
#include <stdio.h>
#include <stdlib.h>
#define SIZE 8

/*aæ˜¯ç›®æ ‡æ•°ç»„ï¼Œbæ˜¯ä¸´æ—¶æ•°ç»„*/
/*Version1*/
void merge(int a[], int begin, int mid, int end, int b[])
{
    /*midæ˜¯å‰ä¸€åŠçš„æœ«å°¾ï¼Œåä¸€åŠçš„å¼€å§‹*/
    int i = begin, j = mid, k = begin;
    while (i < mid && j < end)
    {
        if (a[i] < a[j])
            b[k++] = a[i++];
        else
            b[k++] = a[j++];
    }
    while (i < mid)
        b[k++] = a[i++];
    while (j < end)
        b[k++] = a[j++];
    //mergeå®Œä»¥åbè¦é‡æ–°æ”¾å›aé‡Œï¼Œå¦åˆ™ç™½æ’äº†!!!
    for (int i = begin;i<end;i++) {
        a[i] = b[i];
    }

		/*å¯è§†åŒ–*/
    for (int i = 0; i < begin; i++)
        printf("    ");
    for (int i = begin; i < end; i++)
    {
        printf("%4d",b[i]);
    }
    for (int i = end; i < SIZE; i++)
        printf("    ");
    printf("\n");
}

/*begin is inclusive, end is exclusive*/
void mergeSort(int a[], int begin, int end, int b[])
{
    //base case
    if (end - begin < 2)
        return;
    int mid = (begin + end) / 2;
    mergeSort(a, begin, mid, b);
    mergeSort(a, mid, end, b);
    merge(a, begin, mid, end, b); //åˆäºŒä¸ºä¸€
}

int main()
{
    int a[SIZE], b[SIZE];
    srand(0); //seed == 0
    for (int i = 0; i < SIZE; i++)
    {
        a[i] = rand() % 150;
    }
    for (int i = 0; i < SIZE; i++)
    {
        printf("%4d", a[i]);
    }
    printf("\n");
    mergeSort(a, 0, SIZE, b);
    for (int i = 0; i < SIZE; i++)
    {
        printf("%4d", a[i]);
    }
}
```



#### BottomUp *è‡ªåº•å‘ä¸Šçš„è¿­ä»£å®ç°*

- Topdowé€’è¿›è¿‡ç¨‹å®é™…ä¸Šæ˜¯åˆ‡å‰²ï¼Œæ²¡æœ‰åšä»»ä½•å…¶ä»–äº‹æƒ…ï¼›å› æ­¤å¯ä»¥è€ƒè™‘èˆå¼ƒé€’è¿›ï¼Œç›´æ¥åˆå¹¶

- åŒé‡å¾ªç¯ï¼Œå¤–å±‚å¾ªç¯æ§åˆ¶åˆå¹¶æ¬¡æ•°(logN)ï¼Œå†…å±‚å¾ªç¯æ§åˆ¶æ’åºå°å•å…ƒçš„æ­¥é•¿

```c
int min(int a,int b) {
    if (a>b) return b;
    else return a;
}
/*mergeï¼Œå°†ä¸¤ä¸ªæœ‰åºæ•°åˆ—åˆå¹¶æˆä¸€ä¸ªï¼ŒTopDownå’ŒBottomUpå®Œå…¨ä¸€è‡´*/
void merge(int a[], int begin, int end, int b[])
{
    /*midæ˜¯å‰ä¸€åŠçš„æœ«å°¾ï¼Œåä¸€åŠçš„å¼€å§‹*/
    int mid = (begin+end)/2;
    int i = begin, j = mid, k = begin;
    while (i < mid && j < end)
    {
        if (a[i] < a[j])
            b[k++] = a[i++];
        else
            b[k++] = a[j++];
    }
    while (i < mid)
        b[k++] = a[i++];
    while (j < end)
        b[k++] = a[j++];
    //mergeå®Œä»¥åbè¦é‡æ–°æ”¾å›aé‡Œï¼Œå¦åˆ™ç™½æ’äº†!!!
    for (int i = begin;i<end;i++) {
        a[i] = b[i];
    }
  
/*BottomUp*/
void mergeSort(int a[], int n, int b[])
{
    for (int width = 1;width < n;width *= 2) {//åˆå¹¶æ¬¡æ•°log2N
        for (int i=0;i<n;i = i + width*2) {//æ§åˆ¶å°æ•°ç»„çš„é•¿åº¦
            merge(a,min(i,n),min(i+width*2,n),b);//begin is inclusive, end is exclusive
        }
    }
}
```

ä¸Šé¢æ˜¯é”™çš„,midä¸æ˜¯ä¸­é—´

```c
void Merge(int a[],int begin,int mid,int end) {
    int i = begin,j = mid,k = i;
    int *b = (int *)malloc(sizeof(int)*(end-begin));
    while (i<mid && j<end) {
        if (a[j] < a[i]) b[k++] = a[j++];
        else b[k++] = a[i++];
    }
    while (i<mid) b[k++] = a[i++];
    while (j<end) b[k++] = a[j++];

    for (int i=begin;i<end;i++) {
        a[i] = b[i];
    }
    for (int i = 0; i < begin; i++)
        printf("    ");
    for (int i = begin; i < end; i++)
    {
        printf("%4d",b[i]);
    }
    for (int i = end; i < MAXSIZE; i++)
        printf("    ");
    printf("\n");
}

void* MergeSort(parray *a)
{
    for (int width = 1;width < MAXSIZE;width *= 2) {
        for (int i=0;i<MAXSIZE;i = i + width*2) {
            Merge(a->pBase,i,i+width,min(i+width*2,MAXSIZE));//begin is inclusive, end is exclusive
        }
    }
}
```



#### æ—¶é—´å¤æ‚åº¦

- O(NlogN) 
- é€’è¿›ï¼ˆåˆ†è§£ï¼‰æ— å¾ªç¯ï¼Œä¸æ¶ˆè€—æ—¶é—´
- åˆå¹¶çš„æ—¶å€™ å…±logNå±‚,æ¯ä¸€å±‚å¾ªç¯éå†Næ¬¡ï¼Œå…±è®¡N*logN

#### *Small Trick*:Time(0);

```c
#include <time.h>

int main() {
    time_t then = time(0);
    printf("%ld",time(0) - then);
}
```



### Quick Sort *å¿«é€Ÿæ’åº*

#### æ’åºæ€è·¯

- å–å‡ºåŸºå‡†æ•°*pivot*ï¼Œä½¿pivotå·¦è¾¹çš„æ•°æ¯”å®ƒå°ï¼Œå³è¾¹çš„æ•°æ¯”å®ƒå¤§
- å¯¹å·¦è¾¹å’Œå³è¾¹åˆ†åˆ«å¿«é€Ÿæ’åº(é€’å½’è¿‡ç¨‹)

#### ä»£ç å®ç°

##### å¯»æ‰¾Pivotçš„ä¸€ç§ç®€å•æ–¹æ³•â€”â€”*æŒ–å‘å¡«æ•°*+åˆ†æ²»æ³•

- é€‰å®ša[left]ä¸ºpivotï¼Œæ­¤æ—¶a[left]ç•™ä¸‹äº†ä¸€ä¸ª***å‘***
- `i = left,j = right`,ä»åå‘å‰æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ¯”pivotå°çš„æ•°`j--`ï¼Œå¡«è‡³a[0],å³`a[i] = a[j]`ï¼Œæ­¤æ—¶a[j]æˆä¸ºæ–°å‘
- ä»å‰å‘åæ‰¾åˆ°ç¬¬ä¸€ä¸ªæ¯”pivotå¤§çš„æ•°`i++`ï¼Œå¡«è‡³a[j],å³`a[j] = a[i]`ï¼Œæ­¤æ—¶a[i]æˆä¸ºæ–°å‘
- é‡å¤ä¸Šè¿°ä¸¤æ­¥ï¼Œä½¿å¾—`i==j`ï¼Œ`a[i] = pivot`ï¼Œå³ä¸ºæ‰€æ‰¾åŸºå‡†

![20190612224215809](/Users/particle/Desktop/20190612224215809.jpeg)

```c
int GetPivot(int a[],int i,int j) {
    int pivot = a[i];
    while (i<j) {
        for (;i<j && a[j]>pivot;j--); //ä¸ºä»€ä¹ˆå§‹ç»ˆè¦åˆ¤æ–­i<j?â€”â€”é˜²æ­¢10,9,8,7,6
        if (i<j) a[i] = a[j];
        for (;i<j && a[i]<pivot;i++);
        if (i<j) a[j] = a[i];
    }
    a[i] = pivot;
    return i;
}
```

***æ³¨æ„ï¼šå¯¹å¤§é‡æ•°æ®æ¥è¯´ï¼Œpivotç”¨éšæœºæ•°æ€§èƒ½è¾ƒä¸ºé€‚ä¸­***

##### å¿«æ’é€’å½’

```c
void QuickSort(int a[],int left,int right) {
    if (left < right) {
        int pivot = GetPivot(a,left,right);
        QuickSort(a,left,pivot-1);
        QuickSort(a,pivot+1,right);
    }
}
```

#### æ—¶é—´å¤æ‚åº¦

![æˆªå±2021-06-18 16.53.32](/Users/particle/Desktop/æˆªå±2021-06-18 16.53.32.png)

- Worst case:O(N^2)
- Best case:O(NlogN)
- Average case:O(NlogN)
- ä¸ç¨³å®š



### <stdlib.h>ä¸­çš„æ’åºå‡½æ•°

#### qsort

`void sort(void *base, size_t nel, size_t width,int *(compar)(const void*,const void*))`

